# 🔄 重複データ処理機能デモンストレーション

## 📋 概要

CSVインポート機能に実装された重複データ処理機能の動作について説明します。

## 🎯 重複判定基準

| データ種別 | 重複判定基準 |
|-----------|-------------|
| 🏢 企業データ | `企業名` |
| 🎯 案件データ | `企業名` + `案件名` |
| 👥 コンタクトデータ | `企業名` + `氏名` |

## 🔧 処理オプション

### 1. 🔄 重複を許可（すべて登録）
**動作:** 重複チェックを行わず、すべてのデータを新規として登録
**用途:** 初回インポート、履歴データの保持が必要な場合

**例:**
```
既存データ: 株式会社ABC
CSVデータ: 株式会社ABC
結果: 2件の「株式会社ABC」が登録される
```

### 2. ⏭️ 重複をスキップ（新規のみ登録）
**動作:** 既存データと重複する場合はスキップし、新規データのみ登録
**用途:** 定期的な増分データインポート

**例:**
```
既存データ: 株式会社ABC
CSVデータ: 株式会社ABC, 株式会社DEF
結果: 株式会社ABCはスキップ、株式会社DEFのみ登録
処理結果表示: 新規登録 1件, スキップ 1件
```

### 3. 🔄 重複を更新（既存データを更新）
**動作:** 既存データを新しい情報で更新
**用途:** データのメンテナンス、情報の最新化

**例:**
```
既存データ: 株式会社ABC (業種: 未設定)
CSVデータ: 株式会社ABC (業種: IT・情報通信業)
結果: 既存の株式会社ABCの業種がIT・情報通信業に更新
処理結果表示: 新規登録 0件, 更新 1件
```

## 📊 処理結果の表示

各インポート処理後に詳細な結果が表示されます：

```
📊 企業データ処理結果: 新規登録 5件, スキップ 2件, 更新 3件
📊 案件データ処理結果: 新規登録 10件, スキップ 0件, 更新 5件
📊 コンタクトデータ処理結果: 新規登録 15件, スキップ 3件, 更新 2件
```

## 🧪 テストシナリオ

### シナリオ 1: 初回データインポート
```
設定: 重複を許可（すべて登録）
データ: 企業10件、案件20件、コンタクト50件
期待結果: すべてのデータが新規登録される
```

### シナリオ 2: 増分データ追加
```
設定: 重複をスキップ（新規のみ登録）
データ: 既存企業5件 + 新規企業3件
期待結果: 新規企業3件のみ登録、既存5件はスキップ
```

### シナリオ 3: データメンテナンス
```
設定: 重複を更新（既存データを更新）
データ: 既存企業の業種情報を最新化
期待結果: 既存企業の業種情報が更新される
```

## ⚠️ 注意事項

### データ依存関係
- 案件データとコンタクトデータは企業データに依存
- 存在しない企業に対するデータはスキップされる

### 更新対象フィールド
- **企業データ**: 業種、更新日時
- **案件データ**: ステータス、契約日、人数、担当者など全フィールド
- **コンタクトデータ**: 部署、役職、年齢、優先度、担当者など全フィールド

### パフォーマンス考慮
- 大量データの処理時は重複チェックによる処理時間増加あり
- 初回インポート時は「重複を許可」が最も高速

## 🔍 トラブルシューティング

### よくある問題と対処法

**Q: 重複をスキップしたのに同じデータが登録されている**
A: 重複判定基準を確認してください。企業名や氏名の微細な差異（スペース、全角/半角など）で別データと判定される場合があります。

**Q: 更新したのに情報が変わらない** 
A: CSVの該当列が「選択しない」になっていないか、データが空欄になっていないかを確認してください。

**Q: エラーが発生してインポートが止まる**
A: エラーメッセージを確認し、データ形式や必須項目の入力を確認してください。

---

💡 **おすすめ運用パターン:**
1. **初期導入**: 重複を許可でベースデータを登録
2. **日常運用**: 重複をスキップで新規データのみ追加  
3. **メンテナンス**: 重複を更新で既存データを最新化